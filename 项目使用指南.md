# 实时互动投票系统 - 操作指南 (本地增强版)

本系统已从 Supabase 云端存储迁移至 **本地 JSON 文件存储**，并新增了 **大屏轮播** 功能，更适合内网/局域网及高稳定性要求的活动现场。

---

## 一、 系统部署

### 1. 环境依赖
- Node.js (推荐 v18+)
- 确保电脑和移动端在 **同一 WiFi 网络** 下

### 2. 初始化项目
```bash
# 安装依赖
npm install
```

### 3. 配置数据 (可选)
系统默认已配置演示数据。如需预设问题，可直接编辑：
- `server/data/events.json`: 配置活动名称、问题标题、选项及展现颜色
- 端口号：后端固定在 `4396`

---

## 二、 日常使用

### 1. 启动服务
```bash
# 同时启动后端服务 (4396端口) 和前端 Vite (5173端口)
npm start
```

启动后控制台会显示访问地址。如果是现场活动，请确保使用显式的 **局域网 IP 地址** (如 `http://192.168.1.5:5173`) 而不是 `localhost`。

### 2. 页面说明
| 页面类型 | 访问路径 | 适用角色 | 核心功能 |
| :--- | :--- | :--- | :--- |
| **投票页** | `/vote/demo` | 观众 | 手机扫码投票，防刷票限制 |
| **大屏展示** | `/display/demo` | 投影/LED | **实时结果展示** + **20秒自动轮播** |
| **控制台** | `/control/demo` | 主持人 | 切换当前问题、**清空历史投票** |

---

## 三、 活动现场新特性

### 1. 大屏自动轮播
- **功能**: 大屏展示页会每隔 **20秒** 自动切换到下一个问题的统计结果。
- **手动控制**: 底部设有数字指示器，主持人或导播可点击特定数字立即跳转到对应问题。
- **实时性**: 采用 **200ms 高频轮询**，观众投票后，大屏几乎即时反应。

### 2. 本地化存储
- **稳定性**: 不再依赖 Supabase 网络连接，即使外网断开，局域网内依然可以正常投票。
- **并发性**: 支持 300+ 同时在线投票。
- **备份**: 投票结果实时保存至 `server/data/votes.json`，方便赛后导出统计。

---

## 四、 常用命令

| 命令 | 说明 |
| :--- | :--- |
| `npm start` | **推荐**：一键启动完整系统 |
| `npm run server` | 仅启动本地后端服务 (Port: 4396) |
| `npm run dev` | 仅启动前端项目 (Port: 5173) |
| `npm run add-question`| 快速添加新问题 (命令行交互) |
| `npm run build` | 生产环境构建 |

---

## 五、 活动现场故障排查

1. **手机扫码打不开网页？**
   - 检查手机是否连接了同一 WiFi
   - 检查电脑防火墙是否允许 5173 和 4396 端口通过
   - 确保使用的是 `192.x.x.x` 形式的内网 IP 地址

2. **投票成功了大屏没动？**
   - 检查后端服务是否崩溃（命令行窗口是否有红色报错）
   - 检查 `npm run server` 是否已启动在 4396 端口
   - 尝试刷新大屏页面

3. **如何重新开始一轮投票？**
   - 在 **控制台** 页面点击「🗑️ 清空当前问题投票」，所有观众的手机端会自动重置，允许重新扫码投票。

---

## 六、 提示
- 建议大屏展示页使用 Chrome 浏览器并按 **F11** 进入全屏。
- 定期检查 `server/data/votes.json` 以确认数据已正确落地。
